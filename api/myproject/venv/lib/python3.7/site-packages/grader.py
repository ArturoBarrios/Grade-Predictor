from flask import Flask
from flask_cors import CORS
from flask import request
from MusicPredictionFiles.scripts.PredictSongsNoGUI2 import Predictor
import time
app = Flask(__name__)
CORS(app)

@app.route('/get_grades', methods=['GET', 'POST'])
def get_grades(): 
    print("ressdfffff: ", type(request.files["file0"].filename))
    print("model argg: ", request.args.get('model', ''))

    i = 0
    num_of_files = len(request.files)
    grades = dict()
    files_to_use = getFileNames(str(request.args.get('model','')))
    while i<num_of_files:
        file_name = "file"+str(i)
        file = request.files[file_name].read()
        prediction = Predictor()
        grade = prediction.predictSong(file, files_to_use[0],files_to_use[1])
        print("prediction: ", prediction)
        grades[request.files[file_name].filename] = grade
        i+=1


    return grades


def getFileNames(index):
    res = None
    if(index=="ABRSM(1-8)"):
        res = ["models/abrsm_all_1.sav", "data/abrsm_all_1.csv"]
    elif(index=="Piano Marvel(0-10)"):
        res = ["models/piano_marvel_all_2000_1.sav", "data/piano_marvel_all_2000_1.csv"]
    else:
        res = ["models/abrsm_all_1.sav", "data/abrsm_all_1.csv"]

    
    return res

      
    